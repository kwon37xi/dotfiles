---
- name: extra package install yml
  hosts: 127.0.0.1, localhost
  connection: local
  vars_files:
    - "vars.yml"
  tasks:
    - name: install visual studio code
      become: yes
      apt:
        package:
          - code
    - name: install virtualbox
      become: yes
      apt:
        package: "virtualbox-{{ virtualbox_version }}"
    - name: install video audio graphic packages
      become: yes
      apt:
        package:
          - krita
          - krita-l10n
          - gimp
          - gimp-gmic
          - gimp-data-extras
          - gimp-help-ko
          - nomacs
          - vlc
          - smplayer
          - youtube-dl
          - audacious
          - kdenlive
          - handbrake
    - name: install extra dev related packages
      become: yes
      apt:
        package:
          - vagrant
          - asbru-cm
          - typora
          - unetbootin
          - gh
    - name: add architecture i386
      become: yes
      shell: "dpkg --add-architecture i386"
    - name: install wine & playonlinux
      become: yes
      apt:
        package:
          - wine
          - winetricks
          - playonlinux
    - name: install rust and cargo
      become: yes
      apt:
        package:
          - rustc
          - cargo
    - name: zoom.us preparation
      become: yes
      apt:
        package:
          - libgl1-mesa-glx
          - libegl1-mesa
          - libxcb-xtest0
    - name: download DEBs install
      become: yes
      apt:
        deb: "{{ item }}"
      register: download_debs_installed
      until: download_debs_installed is not failed
      retries: 3
      delay: 10
      with_items:
        - https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        - https://zoom.us/client/latest/zoom_amd64.deb
        - "https://downloads.slack-edge.com/linux_releases/slack-desktop-{{ slack_version }}-amd64.deb"
        - "https://dbeaver.io/files/dbeaver-ce_latest_amd64.deb"
        - "https://github.com/gohugoio/hugo/releases/download/v{{ hugo_version }}/hugo_{{ hugo_version }}_Linux-64bit.deb"
        - "https://github.com/sharkdp/bat/releases/download/v0.15.4/bat_{{ bat_version }}_amd64.deb"
    - name: bitwarden
      become: yes
      flatpak:
        name: "com.bitwarden.desktop"
    - name: packer
      become: yes
      unarchive:
        src: "https://releases.hashicorp.com/packer/{{ packer_version }}/packer_{{ packer_version }}_linux_amd64.zip"
        remote_src: yes
        dest: /usr/local/bin
        mode: 0755
        owner: root
        group: root
      register: packer_installed
      until: packer_installed is not failed
      retries: 3
      delay: 10
    - name: local applications dir
      file:
        path: "/home/{{ current_user }}/.local/share/applications"
        state: directory
    - name: IntelliJ IDEA target dir
      file:
        path: "/home/{{ current_user }}/.local/opt/JetBrains/ideaIU"
        state: directory
    - name: IntelliJ IDEA user install
      unarchive:
        src: "https://download.jetbrains.com/idea/ideaIU-{{ jetbrains_intellij_idea_version }}.tar.gz"
        remote_src: yes
        dest: "/home/{{current_user}}/.local/opt/JetBrains/ideaIU"
        extra_opts: [--strip-components=1]
        creates: "/home/{{ current_user }}/.local/opt/JetBrains/ideaIU/bin/idea.sh"
      register: intellij_idea_installed
      until: intellij_idea_installed is not failed
      retries: 3
      delay: 10
    - name: lotion target dir
      file:
        path: "/home/{{ current_user }}/.local/opt/lotion"
        state: directory
    - name: lotion notion client
      unarchive:
        src: "https://github.com/puneetsl/lotion/archive/V-{{ lotion_version }}.tar.gz"
        remote_src: yes
        dest: "/home/{{ current_user }}/.local/opt/lotion"
        extra_opts: [--strip-components=1]
        creates: "/home/{{ current_user }}/.local/opt/lotion/Lotion/Lotion"
      register: lotion_client_installed
      until: lotion_client_installed is not failed
      retries: 3
      delay: 10
    - name: lotion install
      shell:
        cmd: ./install.sh
        chdir: "/home/{{ current_user }}/.local/opt/lotion"
        creates: "/home/{{ current_user }}/.local/opt/lotion/Lotion/Lotion"
