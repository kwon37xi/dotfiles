---
- name: prepare system environment
  hosts: 127.0.0.1, localhost
  connection: local
  vars_files:
    - "vars.yml"
  tasks:
    - name: xanmod kernel key
      become: yes
      apt_key:
        url: https://dl.xanmod.org/gpg.key
      register: xanmod_kernal_key_installed
      until: xanmod_kernal_key_installed is not failed
      retries: 3
    - name: xanmod kernel repo # linux-xanmod 패키지를 필요하면 설치해준다. LTS 권장. 기본 버전은 너무 최신이라 호환성 이슈 있을 수 있음.
      become: yes
      apt_repository:
        repo: deb http://deb.xanmod.org releases main
        filename: xanmod-kernel
        update_cache: no
    - name: vivaldi browser key
      become: yes
      apt_key:
        url: https://repo.vivaldi.com/archive/linux_signing_key.pub
      register: vivaldi_key_installed
      until: vivaldi_key_installed is not failed
      retries: 3
    - name: vivaldi browser repo
      become: yes
      apt_repository:
        repo: deb https://repo.vivaldi.com/archive/deb/ stable main
        filename: vivaldi
        update_cache: no
    - name: github cli key
      become: yes
      apt_key:
        id: C99B11DEB97541F0
        keyserver: keyserver.ubuntu.com
    - name: github cli repo
      become: yes
      apt_repository:
        repo: "deb https://cli.github.com/packages {{ ubuntu_release }} main"
        filename: github-cli
        update_cache: no
    - name: vscode key
      become: yes
      apt_key:
        url: https://packages.microsoft.com/keys/microsoft.asc
      register: vscode_key_installed
      until: vscode_key_installed is not failed
      retries: 3
    - name: vscode repository
      become: yes
      apt_repository:
        repo: "deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main"
        filename: vscode
        update_cache: no
    - name: typora key
      become: yes
      apt_key:
        url: https://typora.io/linux/public-key.asc
      register: typora_key_installed
      until: typora_key_installed is not failed
      retries: 3
    - name: typora repo
      become: yes
      apt_repository:
        repo: deb https://typora.io/linux ./
        filename: typora
        update_cache: no
    - name: nimf hamonikr key
      become: yes
      apt_key:
        url: https://pkg.hamonikr.org/hamonikr-pkg.key
      register: nimf_key_installed
      until: nimf_key_installed is not failed
      retries: 3
    - name: nimf hamonikr repo
      become: yes
      apt_repository:
        repo: "deb [arch=amd64] https://pkg.hamonikr.org {{ ubuntu_release }} main"
        filename: nimf-hamonikr
        update_cache: no
    - name: add PPAs
      become: yes
      shell: "add-apt-repository -y --no-update {{ item }}"
      with_items:
        - ppa:jonathonf/vim
        - ppa:gezakovacs/ppa
        - ppa:git-core/ppa
        - ppa:graphics-drivers/ppa
        - ppa:linuxuprising/apps
        - ppa:papirus/papirus
        - ppa:appimagelauncher-team/stable
        - ppa:agornostal/ulauncher
    - name: multiverse universe
      become: yes
      shell: "apt-add-repository -y --no-update {{ item }}"
      with_items:
        - multiverse
        - universe
          #- name: asbru-cm
          #become: yes
          #shell: curl -s https://packagecloud.io/install/repositories/asbru-cm/asbru-cm/script.deb.sh | bash
          #args:
          #creates: /etc/apt/sources.list.d/asbru-cm_asbru-cm.list
    - name: update apt cache all
      become: yes
      apt:
        update_cache: yes
    - name: remove snapd
      become: yes
      shell: |
        apt purge -y --autoremove snapd gnome-software-plugin-snap
        rm -rf /snap
        rm -rf /var/snap
        rm -rf /var/lib/snapd
        rm -rf /var/cache/snapd
