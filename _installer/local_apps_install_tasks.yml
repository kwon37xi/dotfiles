---
- name: create bashrc.d dir
  file:
    path: "{{ local_bashrcs_dir }}"
    mode: 0700
    state: directory
- name: create vim related dirs
  file:
    path: "~/.local/tmp/vim/{{ item }}"
    state: directory
  with_items:
    - swap
    - backup
    - undos
- name: create /usr/local/bin
  become: yes
  file:
    path: /usr/local/bin
    state: directory
- name: create local application dirs
  file:
    path: "{{ item }}"
    state: directory
  with_items:
    - ~/.local/opt
    - ~/.local/share/applications
    - ~/.config/autostart
- name: add reading *.bashrc to ~/.bashrc
  lineinfile:
    path: ~/.bashrc
    line: |
    # 오름차순 정렬을 위해서 ls 명령으로 순회한다.
    for bashrc in `ls ~/.config/bashrc.d/*.sh`
    do
        logger "bashrc loading - $bashrc"
        source "$bashrc"
    done
- name: add seesyouspacecowboy to ~/.bash_logout
  lineinfile:
    path: ~/.bash_logout
    line: "bash ~/.local/bin/seeyouspacecowboy.sh; sleep 2"
- name: tldr install
  shell: ~/.dotfiles/local_bin/.local/bin/install-tldr-node-client.sh
- name: tldr update
  shell: "/home/{{ current_user }}/.local/bin/tldr --update"
- name: jenv
  git:
    repo: https://github.com/jenv/jenv.git
    clone: yes
    depth: 1
    dest: ~/.jenv
- name: jenv-export-plugin
  shell: |
    export PATH="$HOME/.jenv/bin:$PATH"
    eval "$(jenv init -)"
    jenv enable-plugin export
  args: # bash가 아니면 작동안함.
    executable: /usr/bin/bash
- name: sdkman
  shell: |
    curl -s "https://get.sdkman.io?rcupdate=false" | bash
  args:
    creates: ~/.sdkman/etc/config
- name: sdkman config auto_answer # 추후 자동생성 ~/.sdkman/etc/config 는 dotfiles 처리시 삭제되고 내 저장소의 것으로 갈아끼워짐
  shell: sed -i  -e "s/sdkman_auto_answer=false/sdkman_auto_answer=true/g" ~/.sdkman/etc/config
- name: sdkman default package install
  shell: |
    source ~/.sdkman/bin/sdkman-init.sh
    sdk install {{ item }}
  args:
    executable: /usr/bin/bash
  with_items:
    - gradle
    - groovy
    - kotlin
    - maven
    - springboot
    - visualvm
  register: sdk_package_installed
  until: sdk_package_installed is not failed
  retries: 3
  delay: 10
